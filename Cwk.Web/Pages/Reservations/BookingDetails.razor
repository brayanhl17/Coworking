@inject NavigationManager NavigationManager

<MudDialog>
    <TitleContent>
        <div class="d-flex align-center">
            <MudIcon Icon="@Icons.Material.Filled.EventNote" Class="mr-3" />
            <MudText Typo="Typo.h6">Detalles de Reservación #@selectedReservation?.Id</MudText>
        </div>
    </TitleContent>
    <DialogContent>
        @if (selectedReservation != null)
        {
            <MudGrid Spacing="3">
                <MudItem xs="12" sm="6">
                    <MudText Typo="Typo.subtitle2" Class="mb-2">Información del Espacio</MudText>
                    <MudCard Variant="Variant.Outlined" Class="pa-3">
                        <MudText Typo="Typo.body1" Class="font-weight-bold">@selectedReservation.SpaceName</MudText>
                        <MudText Typo="Typo.body2" Style="color: #6B7280;">@selectedReservation.SpaceLocation</MudText>
                        <MudText Typo="Typo.caption">$@selectedReservation.PricePerHour/hora</MudText>
                    </MudCard>
                </MudItem>

                <MudItem xs="12" sm="6">
                    <MudText Typo="Typo.subtitle2" Class="mb-2">Usuario</MudText>
                    <MudCard Variant="Variant.Outlined" Class="pa-3">
                        <div class="d-flex align-center">
                            <MudAvatar Style="background-color: #E5E7EB; color: #6B7280;">
                                @GetUserInitials(selectedReservation.UserName)
                            </MudAvatar>
                            <div class="ml-3">
                                <MudText Typo="Typo.body1" Class="font-weight-bold">@selectedReservation.UserName</MudText>
                                <MudText Typo="Typo.caption">ID: @selectedReservation.UserId</MudText>
                            </div>
                        </div>
                    </MudCard>
                </MudItem>

                <MudItem xs="12">
                    <MudText Typo="Typo.subtitle2" Class="mb-2">Detalles de la Reservación</MudText>
                    <MudCard Variant="Variant.Outlined" Class="pa-3">
                        <MudGrid>
                            <MudItem xs="6">
                                <MudText Typo="Typo.caption" Style="color: #6B7280;">Fecha de Inicio</MudText>
                                <MudText Typo="Typo.body1">@selectedReservation.StartTime.ToString("dd/MM/yyyy HH:mm")</MudText>
                            </MudItem>
                            <MudItem xs="6">
                                <MudText Typo="Typo.caption" Style="color: #6B7280;">Fecha de Fin</MudText>
                                <MudText Typo="Typo.body1">@selectedReservation.EndTime.ToString("dd/MM/yyyy HH:mm")</MudText>
                            </MudItem>
                            <MudItem xs="4">
                                <MudText Typo="Typo.caption" Style="color: #6B7280;">Duración</MudText>
                                <MudText Typo="Typo.body1">@selectedReservation.QuantityHours horas</MudText>
                            </MudItem>
                            <MudItem xs="4">
                                <MudText Typo="Typo.caption" Style="color: #6B7280;">Monto Total</MudText>
                                <MudText Typo="Typo.body1" Class="font-weight-bold" Style="color: #059669;">
                                    $@selectedReservation.TotalAmount.ToString("N0")
                                </MudText>
                            </MudItem>
                            <MudItem xs="4">
                                <MudText Typo="Typo.caption" Style="color: #6B7280;">Estado</MudText>
                                @{
                                    var (chipColor, chipIcon) = GetStatusStyle(selectedReservation.ReservationStatus);
                                }
                                <MudChip T="string" Size="Size.Small" Color="chipColor" Icon="chipIcon">
                                    @GetStatusDisplay(selectedReservation.ReservationStatus)
                                </MudChip>
                            </MudItem>
                        </MudGrid>
                    </MudCard>
                </MudItem>
            </MudGrid>
        }
    </DialogContent>
    <DialogActions>
       
    </DialogActions>
</MudDialog>

@code {
    private ReservationDetailsDto? selectedReservation;
    [Parameter] public ReservationDetailsDto reservation { get; set; } = null!;

    protected override void OnParametersSet()
    {
        selectedReservation = reservation;
    }

    private string GetUserInitials(string userName)
    {
        if (string.IsNullOrWhiteSpace(userName)) return "?";

        var parts = userName.Split(' ', StringSplitOptions.RemoveEmptyEntries);
        if (parts.Length >= 2)
            return $"{parts[0][0]}{parts[1][0]}".ToUpper();

        return parts[0][0].ToString().ToUpper();
    }

    private (Color color, string icon) GetStatusStyle(ReservationStatus status)
    {
        return status switch
        {
            ReservationStatus.Pending => (Color.Warning, Icons.Material.Filled.Schedule),
            ReservationStatus.Confirmed => (Color.Success, Icons.Material.Filled.CheckCircle),
            ReservationStatus.Cancelled => (Color.Error, Icons.Material.Filled.Cancel),
            ReservationStatus.Completed => (Color.Info, Icons.Material.Filled.Done),
            _ => (Color.Default, Icons.Material.Filled.Help)
        };
    }

    private string GetStatusDisplay(ReservationStatus status)
    {
        return status switch
        {
            ReservationStatus.Pending => "Pendiente",
            ReservationStatus.Confirmed => "Confirmada",
            ReservationStatus.Cancelled => "Cancelada",
            ReservationStatus.Completed => "Completada",
            _ => status.ToString()
        };
    }

    
}
